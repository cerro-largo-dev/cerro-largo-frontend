<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Caminos que conectan - Gobierno de Cerro Largo</title>
    <meta name="description" content="Plataforma para monitorear y gestionar el estado de caminos rurales en Cerro Largo." />
    <meta name="theme-color" content="#0f172a" />
    <meta property="og:title" content="Caminos que conectan - Gobierno de Cerro Largo" />
    <meta property="og:description" content="Monitoreo y reportes en tiempo real de la caminería rural." />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="es_UY" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />

    <!-- Preconnect para recursos críticos -->
    <link rel="preconnect" href="https://cerro-largo-backend.onrender.com" crossorigin>
    <link rel="dns-prefetch" href="https://cerro-largo-backend.onrender.com">
    
    <!-- Preconnect/DNS para tiles OSM con mayor prioridad -->
    <link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin>
    <link rel="preconnect" href="https://b.tile.openstreetmap.org" crossorigin>
    <link rel="preconnect" href="https://c.tile.openstreetmap.org" crossorigin>
    <link rel="dns-prefetch" href="https://a.tile.openstreetmap.org">
    <link rel="dns-prefetch" href="https://b.tile.openstreetmap.org">
    <link rel="dns-prefetch" href="https://c.tile.openstreetmap.org">

    <!-- Preload de recursos críticos -->
    <link rel="preload" href="/assets/combined_zones.geojson" as="fetch" type="application/json" crossorigin>
    <link rel="modulepreload" href="/src/main.jsx">
    <link rel="modulepreload" href="/src/App.jsx">
    <link rel="modulepreload" href="/src/components/MapComponent.jsx">

    <!-- CSS crítico inline para evitar bloqueo de renderizado -->
    <style>
      /* Reset y base críticos */
      html, body, #root { height: 100%; margin: 0; padding: 0; }
      #root > div.app-root { min-height: 100vh; position: relative; width: 100%; }
      
      /* Estilos críticos para el mapa */
      .leaflet-container { width: 100%; height: 100%; }
      .leaflet-tile { 
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        image-rendering: pixelated;
      }
      
      /* Fuente del sistema para evitar FOIT */
      body { 
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Skeleton loader para el mapa */
      .map-skeleton {
        width: 100%;
        height: 100vh;
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
      }
      
      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }
      
      /* Estilos críticos para accesibilidad */
      .skip-link{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);clip-path:inset(50%);white-space:nowrap;border:0;padding:0;margin:0}
      .skip-link:focus{left:8px;top:8px;width:auto;height:auto;clip:auto;clip-path:none;padding:8px 12px;background:#fff;color:#000;box-shadow:0 0 0 2px #000;z-index:10000}
      .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
      
      /* Variables CSS críticas */
      :root {
        --radius: 0.625rem;
        --background: oklch(1 0 0);
        --foreground: oklch(0.145 0 0);
        --primary: oklch(0.145 0 0);
        --primary-foreground: oklch(1 0 0);
      }
      
      /* Estilos básicos para botones críticos */
      .btn-primary {
        background-color: var(--primary);
        color: var(--primary-foreground);
        border-radius: var(--radius);
        padding: 0.5rem 1rem;
        border: none;
        cursor: pointer;
        font-weight: 500;
      }
    </style>

    <!-- Leaflet CSS con optimizaciones -->
    <link rel="preload" 
          href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          as="style" 
          onload="this.onload=null;this.rel='stylesheet'"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="">
    <noscript>
      <link rel="stylesheet"
            href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
            integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
            crossorigin="">
    </noscript>

    <!-- CSS principal cargado de forma no bloqueante -->
    <link rel="preload" href="/src/App.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link rel="stylesheet" href="/src/App.css"></noscript>

    <!-- Preload de imagen LCP probable (tile central de Cerro Largo) -->
    <link rel="preload" 
          href="https://c.tile.openstreetmap.org/9/178/304.png" 
          as="image" 
          fetchpriority="high"
          crossorigin="anonymous">
  </head>
  <body>
    <a class="skip-link" href="#main">Saltar al contenido principal</a>
    <noscript>Esta aplicación requiere JavaScript habilitado.</noscript>
    
    <!-- Skeleton loader mostrado mientras carga React -->
    <div id="root">
      <div class="map-skeleton" id="loading-skeleton" aria-label="Cargando mapa..."></div>
    </div>
    
    <!-- Script principal con optimizaciones -->
    <script type="module">
      // Remover skeleton cuando React esté listo
      window.addEventListener('DOMContentLoaded', () => {
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.type === 'childList') {
              const skeleton = document.getElementById('loading-skeleton');
              if (skeleton && document.querySelector('.leaflet-container')) {
                skeleton.remove();
                observer.disconnect();
              }
            }
          });
        });
        observer.observe(document.getElementById('root'), { childList: true, subtree: true });
      });
      
      // Precargar datos críticos
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw-enhanced.js').catch(() => {});
        });
      }
    </script>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

